<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>VÃ²ng Quay May Máº¯n</title>
<style>
  body{font-family:Arial;background:#0b132b;color:white;text-align:center}
  .wheel-container{position:relative;width:300px;height:300px;margin:30px auto}
  canvas{background:#fff;border-radius:50%}
  .pointer{
    width:0;height:0;
    border-left:15px solid transparent;
    border-right:15px solid transparent;
    border-bottom:30px solid red;
    position:absolute;top:-25px;left:50%;
    transform:translateX(-50%);
  }
  input,button{padding:8px;margin:6px;border-radius:5px;border:none}
  .admin-box{background:#1c2541;padding:10px;margin:15px;border-radius:8px}
  .result{margin-top:10px;font-size:18px;color:#ffd166}
</style>
</head>
<body>

<h2>ğŸ VÃ’NG QUAY MAY Máº®N</h2>

<!-- KHU ADMIN -->
<div class="admin-box">
  <b>ğŸ‘‘ KHU ADMIN</b><br>
  <input type="password" id="adminPass" placeholder="Nháº­p mÃ£ admin">
  <button onclick="loginAdmin()">ÄÄƒng nháº­p</button>
  <div id="adminPanel" style="display:none;margin-top:8px">
    <button onclick="allowSpin()">âœ… Cho phÃ©p ngÆ°á»i chÆ¡i quay</button>
    <button onclick="lockSpin()">ğŸ”’ KhÃ³a quyá»n quay</button>
    <p>Tráº¡ng thÃ¡i: <b id="status">Äang khÃ³a</b></p>
  </div>
</div>

<!-- NHáº¬P TÃŠN -->
<input type="text" id="playerName" placeholder="TÃªn ngÆ°á»i chÆ¡i">

<div class="wheel-container">
  <div class="pointer"></div>
  <canvas id="wheel" width="300" height="300"></canvas>
</div>

<button onclick="spin()">QUAY NGAY</button>
<div class="result" id="result"></div>

<script>
/* ================== CÃ€I Äáº¶T ================== */
// ğŸ‘‰ Äá»”I MÃƒ ADMIN á» ÄÃ‚Y
const ADMIN_CODE = "123456";

/* ================== PHáº¦N QUÃ€ ================== */
const rewards = [
  "Skin khá»§ng long",
  "1000 Point Shop",
  "Pet mini",
  "VIP 7 ngÃ y",
  "VIP 30 ngÃ y",
  "ThÃº huyá»n thoáº¡i"
];

/* ================== BIáº¾N ================== */
let adminLogged = false;
let allowUserSpin = false;
let spinning = false;
let angle = 0;

/* ================== Váº¼ VÃ’NG QUAY ================== */
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const size = canvas.width;
const center = size/2;
const slice = 2*Math.PI/rewards.length;

function drawWheel(){
  ctx.clearRect(0,0,size,size);
  for(let i=0;i<rewards.length;i++){
    ctx.beginPath();
    ctx.moveTo(center,center);
    ctx.arc(center,center,center,angle+i*slice,angle+(i+1)*slice);
    ctx.fillStyle = i%2==0 ? "#3a86ff" : "#8338ec";
    ctx.fill();
    ctx.save();
    ctx.translate(center,center);
    ctx.rotate(angle+i*slice+slice/2);
    ctx.fillStyle="white";
    ctx.textAlign="right";
    ctx.font="14px Arial";
    ctx.fillText(rewards[i],center-10,5);
    ctx.restore();
  }
}
drawWheel();

/* ================== ADMIN ================== */
function loginAdmin(){
  const pass = document.getElementById("adminPass").value;
  if(pass === ADMIN_CODE){
    adminLogged = true;
    document.getElementById("adminPanel").style.display="block";
    alert("ÄÄƒng nháº­p admin thÃ nh cÃ´ng!");
  }else{
    alert("Sai mÃ£ admin!");
  }
}

function allowSpin(){
  allowUserSpin = true;
  document.getElementById("status").innerText="ÄANG Má»";
}

function lockSpin(){
  allowUserSpin = false;
  document.getElementById("status").innerText="ÄANG KHÃ“A";
}

/* ================== QUAY ================== */
function spin(){
  if(spinning) return;

  const name = document.getElementById("playerName").value || "NgÆ°á»i chÆ¡i";

  // Náº¿u khÃ´ng pháº£i admin â†’ pháº£i Ä‘Æ°á»£c cho phÃ©p
  if(!adminLogged && !allowUserSpin){
    alert("âŒ Báº¡n chÆ°a Ä‘Æ°á»£c phÃ©p quay! HÃ£y chá» admin má»Ÿ quyá»n.");
    return;
  }

  spinning = true;
  document.getElementById("result").innerHTML="";

  const spinTime = 4000;
  const finalAngle = Math.random()*360 + 1440;
  const start = Date.now();

  function animate(){
    const now = Date.now();
    const progress = Math.min((now-start)/spinTime,1);
    const ease = 1 - Math.pow(1-progress,3);
    angle = (finalAngle*ease)*Math.PI/180;
    drawWheel();

    if(progress<1){
      requestAnimationFrame(animate);
    }else{
      spinning=false;
      showResult(name);
      // Sau khi ngÆ°á»i chÆ¡i quay xong â†’ tá»± khÃ³a láº¡i
      if(!adminLogged){
        allowUserSpin=false;
        document.getElementById("status").innerText="ÄANG KHÃ“A";
      }
    }
  }
  animate();
}

function showResult(name){
  const deg = angle*180/Math.PI + 90;
  const index = rewards.length - Math.floor((deg%360)/(360/rewards.length)) - 1;
  const reward = rewards[(index+rewards.length)%rewards.length];
  document.getElementById("result").innerHTML =
    "ğŸ‰ <b>"+name+"</b> trÃºng: <b>"+reward+"</b>";
}
</script>

</body>
</html>
