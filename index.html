<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>VÃ²ng Quay May Máº¯n</title>
<style>
body{font-family:Arial;background:#0b132b;color:white;text-align:center}
.wheel-box{position:relative;width:320px;height:320px;margin:20px auto}
canvas{background:#fff;border-radius:50%}
.pointer{
  width:0;height:0;
  border-left:14px solid transparent;
  border-right:14px solid transparent;
  border-bottom:28px solid red;
  position:absolute;top:-24px;left:50%;
  transform:translateX(-50%);
}
input,button{padding:8px;margin:5px;border-radius:6px;border:none}
.admin{background:#1c2541;padding:10px;border-radius:8px;margin:10px}
.hidden{display:none}
#result{margin-top:10px;color:#ffd166;font-size:18px}
</style>
</head>
<body>

<h2>ğŸ VÃ’NG QUAY MAY Máº®N</h2>

<!-- ===== ADMIN ===== -->
<div class="admin">
  <b>ğŸ‘‘ ADMIN</b><br>
  <input type="password" id="adminPass" placeholder="MÃ£ admin">
  <button onclick="loginAdmin()">ÄÄƒng nháº­p</button>
  <div id="adminPanel" class="hidden">
    <p>MÃ£ quay hiá»‡n táº¡i:</p>
    <h3 id="currentCode">----</h3>
  </div>
</div>

<!-- ===== NGÆ¯á»œI CHÆ I ===== -->
<div>
  <input id="userCode" placeholder="Nháº­p mÃ£ quay">
  <button onclick="verifyCode()">XÃ¡c nháº­n mÃ£</button>
  <p id="status" style="color:#ffd166"></p>
</div>

<div class="wheel-box">
  <div class="pointer"></div>
  <canvas id="wheel" width="320" height="320"></canvas>
</div>

<button onclick="spin()">ğŸ° QUAY</button>
<div id="result"></div>

<script>
/* ===== CÃ€I Äáº¶T ===== */
const ADMIN_CODE = "2007";
let spinCode = "1000";     // mÃ£ quay ban Ä‘áº§u
let allowSpin = false;
let adminLogged = false;

/* ===== PHáº¦N THÆ¯á»NG ===== */
const rewards = [
  "1 Quetzal",
  "1 Giga",
  "8000 Amber",
  "1 CÃ¡ sáº¥u",
  "SÃºng Tek xá»‹n",
  "Tek Rep",
  "Shotgun (6 viÃªn)",
  "Sniper",
  "GF 400 Speed",
  "10K Amber"
];

/* ===== CANVAS ===== */
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const size = canvas.width;
const center = size/2;
const slice = 2*Math.PI/rewards.length;
let angle = 0;
let spinning = false;

/* ===== Váº¼ VÃ’NG QUAY ===== */
function drawWheel(){
  ctx.clearRect(0,0,size,size);
  for(let i=0;i<rewards.length;i++){
    ctx.beginPath();
    ctx.moveTo(center,center);
    ctx.arc(center,center,center,i*slice + angle,(i+1)*slice + angle);
    ctx.fillStyle = i%2==0 ? "#3a86ff" : "#8338ec";
    ctx.fill();

    ctx.save();
    ctx.translate(center,center);
    ctx.rotate(i*slice + angle + slice/2);
    ctx.fillStyle="white";
    ctx.font="12px Arial";
    ctx.textAlign="right";
    ctx.fillText(rewards[i],center-10,5);
    ctx.restore();
  }
}
drawWheel();

/* ===== ADMIN ===== */
function loginAdmin(){
  const pass = document.getElementById("adminPass").value;
  if(pass === ADMIN_CODE){
    adminLogged = true;
    document.getElementById("adminPanel").classList.remove("hidden");
    document.getElementById("currentCode").innerText = spinCode;
    alert("âœ… ÄÄƒng nháº­p admin thÃ nh cÃ´ng!");
  }else alert("âŒ Sai mÃ£ admin!");
}

/* ===== NGÆ¯á»œI CHÆ I NHáº¬P MÃƒ ===== */
function verifyCode(){
  const input = document.getElementById("userCode").value.trim();

  if(input === spinCode){
    // RESET TRáº NG THÃI Má»–I Láº¦N NHáº¬P ÄÃšNG
    allowSpin = true;
    spinning = false;

    document.getElementById("status").innerText =
      "âœ… MÃ£ há»£p lá»‡! Báº¡n Ä‘Æ°á»£c quay 1 láº§n.";
  }else{
    allowSpin = false;
    document.getElementById("status").innerText =
      "âŒ MÃ£ khÃ´ng Ä‘Ãºng!";
  }
}

/* ===== QUAY ===== */
function spin(){
  if(spinning) return;
  if(!allowSpin){
    alert("â›” Nháº­p mÃ£ quay trÆ°á»›c!");
    return;
  }

  spinning = true;
  document.getElementById("result").innerHTML="";

  const spinTime = 4000;
  const winIndex = Math.floor(Math.random()*rewards.length);

  // canvas váº½ tá»« 3h, mÅ©i tÃªn á»Ÿ 12h â†’ bÃ¹ 90Â°
  const pointerOffset = Math.PI/2;

  const stopAngle =
    (2*Math.PI) - (winIndex*slice + slice/2) + pointerOffset;

  const finalAngle = stopAngle + 6*2*Math.PI;
  const start = Date.now();
  const startAngle = angle;

  function animate(){
    const now = Date.now();
    const progress = Math.min((now-start)/spinTime,1);
    const ease = 1 - Math.pow(1-progress,3);
    angle = startAngle + (finalAngle-startAngle)*ease;
    drawWheel();

    if(progress<1){
      requestAnimationFrame(animate);
    }else{
      spinning=false;

      document.getElementById("result").innerHTML =
        "ğŸ‰ TrÃºng: <b>"+rewards[winIndex]+"</b>";

      /* ===== RESET + Äá»”I MÃƒ ===== */
      allowSpin = false;
      spinning = false;

      document.getElementById("status").innerText =
        "ğŸ”’ ÄÃ£ dÃ¹ng lÆ°á»£t. Nháº­p mÃ£ má»›i Ä‘á»ƒ quay tiáº¿p.";

      spinCode = generateNewCode();
      if(adminLogged)
        document.getElementById("currentCode").innerText = spinCode;

      document.getElementById("userCode").value="";
    }
  }
  animate();
}

/* ===== Táº O MÃƒ Má»šI ===== */
function generateNewCode(){
  return Math.floor(1000 + Math.random()*9000).toString();
}
</script>

</body>
</html>
