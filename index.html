<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>VÃ²ng Quay May Máº¯n</title>
<style>
body{font-family:Arial;background:#0b132b;color:white;text-align:center}
.wheel-container{position:relative;width:320px;height:320px;margin:20px auto}
canvas{background:#fff;border-radius:50%}
.pointer{
  width:0;height:0;
  border-left:15px solid transparent;
  border-right:15px solid transparent;
  border-bottom:30px solid red;
  position:absolute;top:-25px;left:50%;
  transform:translateX(-50%);
}
input,button{padding:8px;margin:5px;border-radius:6px;border:none}
.admin-box{background:#1c2541;padding:10px;margin:15px;border-radius:8px}
.hidden{display:none}
.result{margin-top:10px;font-size:18px;color:#ffd166}
</style>
</head>
<body>

<h2>ğŸ VÃ’NG QUAY MAY Máº®N</h2>

<!-- ADMIN -->
<div class="admin-box">
  <b>ğŸ‘‘ KHU ADMIN</b><br>
  <input type="password" id="adminPass" placeholder="MÃ£ admin">
  <button onclick="loginAdmin()">ÄÄƒng nháº­p</button>

  <div id="adminPanel" class="hidden">
    <p>ğŸ”‘ <b>MÃ£ quay hiá»‡n táº¡i:</b></p>
    <h3 id="currentCode">----</h3>

    <input id="openCode" placeholder="Nháº­p mÃ£ quay">
    <button onclick="openOneSpin()">Má»Ÿ 1 lÆ°á»£t quay</button>

    <p>Tráº¡ng thÃ¡i: <b id="spinStatus">Äang khÃ³a</b></p>
  </div>
</div>

<input id="playerName" placeholder="TÃªn ngÆ°á»i chÆ¡i">

<div class="wheel-container">
  <div class="pointer"></div>
  <canvas id="wheel" width="320" height="320"></canvas>
</div>

<button onclick="spin()">ğŸ° QUAY NGAY</button>
<div class="result" id="result"></div>

<script>
/* ====== CÃ€I Äáº¶T ====== */
const ADMIN_CODE = "2007";
let spinCode = "1000";
let allowSpin = false;
let adminLogged = false;

/* ====== PHáº¦N THÆ¯á»NG + Tá»ˆ Lá»† ====== */
const rewards = [
  { name:"1 Quetzal", chance:5 },
  { name:"1 Giga", chance:5 },
  { name:"8000 Amber", chance:20 },
  { name:"1 CÃ¡ sáº¥u", chance:10 },
  { name:"SÃºng Tek xá»‹n", chance:2 },
  { name:"Tek Rep", chance:20 },
  { name:"Shotgun (6 viÃªn)", chance:18 },
  { name:"Sniper", chance:8 },
  { name:"GF 400 Speed", chance:2 },
  { name:"10K Amber", chance:10 }
];

/* ====== RANDOM THEO Tá»ˆ Lá»† ====== */
function getRandomReward(){
  let total = 0;
  rewards.forEach(r=>total+=r.chance);
  let rand = Math.random()*total;
  for(let r of rewards){
    if(rand < r.chance) return r.name;
    rand -= r.chance;
  }
}

/* ====== Váº¼ VÃ’NG QUAY ====== */
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const size = canvas.width;
const center = size/2;
const slice = 2*Math.PI/rewards.length;
let angle = 0;
let spinning = false;

function drawWheel(){
  ctx.clearRect(0,0,size,size);
  for(let i=0;i<rewards.length;i++){
    ctx.beginPath();
    ctx.moveTo(center,center);
    ctx.arc(center,center,center,angle+i*slice,angle+(i+1)*slice);
    ctx.fillStyle = i%2==0 ? "#3a86ff" : "#8338ec";
    ctx.fill();

    ctx.save();
    ctx.translate(center,center);
    ctx.rotate(angle+i*slice+slice/2);
    ctx.fillStyle="white";
    ctx.font="13px Arial";
    ctx.textAlign="right";
    ctx.fillText(rewards[i].name,center-10,5);
    ctx.restore();
  }
}
drawWheel();

/* ====== ADMIN ====== */
function loginAdmin(){
  const pass = document.getElementById("adminPass").value;
  if(pass === ADMIN_CODE){
    adminLogged = true;
    document.getElementById("adminPanel").classList.remove("hidden");
    document.getElementById("currentCode").innerText = spinCode;
    alert("âœ… ÄÄƒng nháº­p admin thÃ nh cÃ´ng!");
  }else alert("âŒ Sai mÃ£ admin!");
}

function openOneSpin(){
  if(!adminLogged) return;
  const codeInput = document.getElementById("openCode").value;
  if(codeInput === spinCode){
    allowSpin = true;
    document.getElementById("spinStatus").innerText = "ÄANG Má» (1 lÆ°á»£t)";
    alert("ğŸ‰ ÄÃ£ má»Ÿ 1 lÆ°á»£t quay!");
  }else alert("âŒ Sai mÃ£ quay!");
}

/* ====== QUAY ====== */
function spin(){
  if(spinning) return;

  const name = document.getElementById("playerName").value || "NgÆ°á»i chÆ¡i";
  if(!allowSpin){
    alert("â›” ChÆ°a Ä‘Æ°á»£c phÃ©p quay!");
    return;
  }

  spinning = true;
  document.getElementById("result").innerHTML="";

  const spinTime = 4000;
  const finalAngle = Math.random()*360 + 1440;
  const start = Date.now();

  function animate(){
    const now = Date.now();
    const progress = Math.min((now-start)/spinTime,1);
    const ease = 1 - Math.pow(1-progress,3);
    angle = (finalAngle*ease)*Math.PI/180;
    drawWheel();

    if(progress<1){
      requestAnimationFrame(animate);
    }else{
      spinning=false;

      const reward = getRandomReward();
      document.getElementById("result").innerHTML =
        "ğŸ‰ <b>"+name+"</b> trÃºng: <b>"+reward+"</b>";

      // khÃ³a láº¡i + Ä‘á»•i mÃ£
      allowSpin = false;
      document.getElementById("spinStatus").innerText = "Äang khÃ³a";
      spinCode = generateNewCode();
      if(adminLogged)
        document.getElementById("currentCode").innerText = spinCode;
    }
  }
  animate();
}

/* ====== Táº O MÃƒ Má»šI ====== */
function generateNewCode(){
  return Math.floor(1000 + Math.random()*9000).toString();
}
</script>

</body>
</html>
